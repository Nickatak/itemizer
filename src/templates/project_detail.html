<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project.name }} - Project Details</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/project_detail.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modals/add_task_modal.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modals/edit_task_modal.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modals/material_modal.css') }}">
    <script src="{{ url_for('static', filename='js/modals/add_task_modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modals/edit_task_modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modals/add_material_modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modals/edit_material_modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/project_detail.js') }}"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-flex-container">
                <div></div>
                <a href="/projects" class="back-arrow" title="Back to Projects">✕</a>
            </div>
            <h1 class="project-title">{{ project.name }}</h1>
            <div class="project-id">Project ID: {{ project.id }}</div>
        </div>

        <div class="project-details">
            <div class="detail-section">
                <div class="detail-label">
                    Name
                    <button id="editNameBtn" class="edit-description-icon-btn" title="Edit name">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
                <div class="detail-value">
                    <div id="nameView">
                        <div class="name-text">{{ project.name }}</div>
                    </div>
                    <div id="nameEdit" style="display: none;">
                        <input type="text" id="nameInput" class="editable-input" value="{{ project.name }}">
                        <div class="detail-actions">
                            <button id="saveNameBtn" class="action-btn save-btn">Save</button>
                            <button id="cancelNameBtn" class="action-btn cancel-btn">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail-section description-section">
                <div class="detail-label">
                    Description
                    <button id="editDescriptionBtn" class="edit-description-icon-btn" title="Edit description">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
                <div class="detail-value">
                    <div id="descriptionView">
                        {% if project.description %}
                            <div class="description-text">{{ project.description }}</div>
                        {% else %}
                            <div class="no-description">No description provided.</div>
                        {% endif %}
                    </div>
                    <div id="descriptionEdit" style="display: none;">
                        <textarea id="descriptionTextarea" class="description-textarea">{{ project.description or '' }}</textarea>
                        <div class="description-actions">
                            <button id="saveDescriptionBtn" class="action-btn save-btn">Save</button>
                            <button id="cancelDescriptionBtn" class="action-btn cancel-btn">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <div class="detail-label">
                    Start Date
                    <button id="editStartDateBtn" class="edit-description-icon-btn" title="Edit start date">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
                <div class="detail-value">
                    <div id="startDateView">
                        <div class="date-text">
                            {% if project.start_date %}
                                {{ project.start_date.strftime('%b %d %Y') }}
                            {% else %}
                                <em>Start Date Undetermined</em>
                            {% endif %}
                        </div>
                    </div>
                    <div id="startDateEdit" style="display: none;">
                        <input type="date" id="startDateInput" class="editable-input" value="{{ project.start_date.strftime('%Y-%m-%d') if project.start_date else '' }}">
                        <div class="detail-actions">
                            <button id="saveStartDateBtn" class="action-btn save-btn">Save</button>
                            <button id="cancelStartDateBtn" class="action-btn cancel-btn">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
  

            <div class="detail-section">
                <div class="detail-label">
                    End Date
                    <button id="editEndDateBtn" class="edit-description-icon-btn" title="Edit end date">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
                <div class="detail-value">
                    <div id="endDateView">
                        <div class="date-text">
                            {% if project.end_date %}
                                {{ project.end_date.strftime('%b %d %Y') }}
                            {% else %}
                                <em>End Date Undetermined</em>
                            {% endif %}
                        </div>
                    </div>
                    <div id="endDateEdit" style="display: none;">
                        <input type="date" id="endDateInput" class="editable-input" value="{{ project.end_date.strftime('%Y-%m-%d') if project.end_date else '' }}">
                        <div class="detail-actions">
                            <button id="saveEndDateBtn" class="action-btn save-btn">Save</button>
                            <button id="cancelEndDateBtn" class="action-btn cancel-btn">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <div class="detail-label">
                    Status
                    <button id="editStatusBtn" class="edit-description-icon-btn" title="Edit status">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
                <div class="detail-value">
                    <div id="statusView">
                        {% if project.is_complete %}
                            <span class="status-badge completed">✓ Completed</span>
                        {% else %}
                            <span class="status-badge active">In Progress</span>
                        {% endif %}
                    </div>
                    <div id="statusEdit" style="display: none;">
                        <label class="status-checkbox-label">
                            <input type="checkbox" id="statusCheckbox" {% if project.is_complete %}checked{% endif %}>
                            Mark as completed
                        </label>
                        <div class="detail-actions">
                            <button id="saveStatusBtn" class="action-btn save-btn">Save</button>
                            <button id="cancelStatusBtn" class="action-btn cancel-btn">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail-section materials-section">
                <div class="materials-header">
                    <div class="materials-title">Materials ({{ project.materials|length }})</div>
                    <button class="add-material-btn">Add Material</button>
                </div>

                <div class="materials-list">
                    {% if project.materials %}
                        <table class="materials-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Price</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pm in project.materials %}
                                    <tr class="material-row">
                                        <td class="material-name-cell">
                                            <a href="/material/{{ pm.material.id }}" class="material-link">{{ pm.material.name }}</a>
                                        </td>
                                        <td class="material-description-cell">
                                            {% if pm.material.description %}
                                                {{ pm.material.description[:60] }}{% if pm.material.description|length > 60 %}...{% endif %}
                                            {% else %}
                                                <em>No description</em>
                                            {% endif %}
                                        </td>
                                        <td class="material-price-cell">
                                            {% if pm.material.price %}
                                                ${{ "%.2f"|format(pm.material.price) }}
                                            {% else %}
                                                <em>N/A</em>
                                            {% endif %}
                                        </td>
                                        <td class="material-action-cell">
                                            <button type="button" class="edit-material-btn" data-material-id="{{ pm.material.id }}" data-material-name="{{ pm.material.name }}" data-material-description="{{ pm.material.description or '' }}" data-material-price="{{ pm.material.price or 'null' }}" data-material-link="{{ pm.material.link or '' }}" data-material-specification-notes="{{ pm.material.specification_notes or '' }}" data-material-tags='{{ pm.material.tags|map(attribute="id")|list|tojson }}'>Edit</button>
                                            <button type="button" class="remove-material-btn" data-material-id="{{ pm.material.id }}">Remove</button>
                                            <div id="materialDeleteConfirmation-{{ pm.material.id }}" class="material-delete-confirmation hidden">
                                                <span class="confirmation-text">Remove this material?</span>
                                                <button class="action-btn delete-confirm-btn" data-project-id="{{ project.id }}" data-material-id="{{ pm.material.id }}">Yes</button>
                                                <button class="action-btn cancel-btn" data-material-id="{{ pm.material.id }}">Cancel</button>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        
                        <div class="materials-summary">
                            <div class="materials-summary-row">
                                <span class="materials-summary-label">Material Count:</span>
                                <span class="materials-summary-value">
                                    {{ project.materials|length }}
                                </span>
                            </div>
                            <div class="materials-summary-row">
                                <span class="materials-summary-total-label">Total Materials Cost:</span>
                                <span class="materials-summary-total-value">
                                    {% set total = project.materials|sum(attribute='material.price', start=0) %}
                                    ${{ "%.2f"|format(total) }}
                                </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="no-materials">
                            <p>No materials assigned to this project yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="detail-section tasks-section">
                <div class="tasks-header">
                    <div class="tasks-title">Tasks ({{ project.tasks|length }})</div>
                    <div class="tasks-header-flex">
                        <label class="toggle-completed-label">
                            <input type="checkbox" id="toggleCompletedTasks" class="toggle-completed-checkbox">
                            Show completed tasks
                        </label>
                        <button class="add-task-btn">Add Task</button>
                    </div>
                </div>

                <div class="tasks-list">
                    {% if project.tasks %}
                        {% for task in project.tasks %}
                            <div class="task-card" data-completed="{{ task.is_completed|lower }}">
                                <div class="task-name"><span class="task-order-number">#{{ task.order }}</span>{{ task.name }}</div>
                                <div class="task-description">
                                    {% if task.description %}
                                        {{ task.description }}
                                    {% else %}
                                        <em>No description</em>
                                    {% endif %}
                                </div>
                                <div class="task-details">
                                    {% if task.difficulty %}
                                        <span class="task-difficulty difficulty-{{ task.difficulty.lower().replace(' ', '-') }}">{{ task.difficulty }}</span>
                                    {% endif %}
                                    {% if task.completion_percentage %}
                                        <span class="task-completion">{{ task.completion_percentage }}% complete</span>
                                    {% endif %}
                                    {% if task.is_completed %}
                                        <span class="task-status completed">✓ Completed</span>
                                    {% else %}
                                        <span class="task-status pending">In Progress</span>
                                    {% endif %}
                                </div>
                                <div class="task-dates">
                                    {% if task.start_date %}
                                        <div class="task-date">Start: {{ task.start_date.strftime('%b %d %Y at %-I:%M %p') }}</div>
                                    {% endif %}
                                    {% if task.end_date %}
                                        <div class="task-date">End: {{ task.end_date.strftime('%b %d %Y at %-I:%M %p') }}</div>
                                    {% endif %}
                                </div>
                                <div class="task-meta">Created: {{ task.created_at.strftime('%b %d %Y at %-I:%M %p') }}</div>
                                <div class="task-actions-inline">
                                    <button type="button" class="edit-task-btn edit-task-btn-inline" data-task-id="{{ task.id }}" data-task-name="{{ task.name }}" data-task-description="{{ task.description or '' }}" data-task-completed="{{ task.is_completed|lower }}" data-task-start-date="{{ task.start_date.strftime('%Y-%m-%d') if task.start_date else '' }}" data-task-end-date="{{ task.end_date.strftime('%Y-%m-%d') if task.end_date else '' }}" data-task-difficulty="{{ task.difficulty or '' }}" data-task-completion-percentage="{{ task.completion_percentage or 0 }}">Edit</button>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="no-tasks">
                            No tasks yet. Click "Add Task" to create your first task for this project.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="action-btn delete-btn">Delete Project</button>
            <div id="deleteConfirmation" class="delete-confirmation hidden">
                <span class="confirmation-text">Are you sure? This will also delete all associated tasks.</span>
                <button class="action-btn delete-confirm-btn" data-project-id="{{ project.id }}">Yes, Delete</button>
                <button class="action-btn cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal">
        <div>
            <span class="close">&times;</span>
            <h2>Add New Task</h2>
            
            <!-- Create Task Form -->
            <form id="createTaskForm" action="/tasks" method="POST">
                <input type="hidden" name="project_id" value="{{ project.id }}">
                <div>
                    <label for="task_name">Task Name</label>
                    <input type="text" id="task_name" name="name" required>
                </div>
                <div>
                    <label for="task_description">Description</label>
                    <textarea id="task_description" name="description"></textarea>
                </div>
                <div>
                    <label for="task_start_date">Start Date</label>
                    <input type="date" id="task_start_date" name="start_date">
                </div>
                <div>
                    <label for="task_end_date">End Date</label>
                    <input type="date" id="task_end_date" name="end_date">
                </div>
                <div>
                    <label>Difficulty</label>
                    <input type="hidden" id="task_difficulty" name="difficulty" value="">
                    <div class="difficulty-grid">
                        <button type="button" class="difficulty-btn" data-difficulty="Easy">Easy</button>
                        <button type="button" class="difficulty-btn" data-difficulty="Medium">Medium</button>
                        <button type="button" class="difficulty-btn" data-difficulty="Hard">Hard</button>
                        <button type="button" class="difficulty-btn" data-difficulty="Very Hard">Very Hard</button>
                    </div>
                </div>
                <div>
                    <label for="task_completion_percentage">Completion Percentage (%)</label>
                    <select id="task_completion_percentage" name="completion_percentage">
                        <option value="0">0%</option>
                        <option value="10">10%</option>
                        <option value="25">25%</option>
                        <option value="50">50%</option>
                        <option value="75">75%</option>
                        <option value="90">90%</option>
                        <option value="100">100%</option>
                    </select>
                </div>
                <div>
                    <label class="task-checkbox-label">
                        <input type="checkbox" id="task_is_completed" name="is_completed">
                        Mark as completed
                    </label>
                </div>
                <button type="submit">Create Task</button>
            </form>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="editTaskModal">
        <div>
            <span class="close">&times;</span>
            <h2>Edit Task</h2>
            
            <!-- Edit Task Form -->
            <form id="editTaskForm">
                <input type="hidden" id="edit_task_id">
                <div>
                    <label for="edit_task_name">Task Name</label>
                    <input type="text" id="edit_task_name" required>
                </div>
                <div>
                    <label for="edit_task_description">Description</label>
                    <textarea id="edit_task_description"></textarea>
                </div>
                <div>
                    <label for="edit_task_start_date">Start Date</label>
                    <input type="date" id="edit_task_start_date">
                </div>
                <div>
                    <label for="edit_task_end_date">End Date</label>
                    <input type="date" id="edit_task_end_date">
                </div>
                <div>
                    <label>Difficulty</label>
                    <input type="hidden" id="edit_task_difficulty" value="">
                    <div class="difficulty-grid">
                        <button type="button" class="edit-difficulty-btn" data-difficulty="Easy">Easy</button>
                        <button type="button" class="edit-difficulty-btn" data-difficulty="Medium">Medium</button>
                        <button type="button" class="edit-difficulty-btn" data-difficulty="Hard">Hard</button>
                        <button type="button" class="edit-difficulty-btn" data-difficulty="Very Hard">Very Hard</button>
                    </div>
                </div>
                <div>
                    <label for="edit_task_completion_percentage">Completion Percentage (%)</label>
                    <select id="edit_task_completion_percentage">
                        <option value="0">0%</option>
                        <option value="10">10%</option>
                        <option value="25">25%</option>
                        <option value="50">50%</option>
                        <option value="75">75%</option>
                        <option value="90">90%</option>
                        <option value="100">100%</option>
                    </select>
                </div>
                <div>
                    <label class="checkbox-label">
                        <input type="checkbox" id="edit_task_is_completed">
                        Mark as completed
                    </label>
                </div>
                <div class="button-group">
                    <button type="submit">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Material Selection Modal -->
    <div id="materialModal">
        <div>
            <span class="close">&times;</span>
            <h2 id="materialModalTitle">Add Material to Project</h2>

            <!-- Tab Navigation -->
            <div class="material-modal-tabs">
                <button id="searchTab" class="tab-button active" data-tab="search">Search Materials</button>
                <button id="createTab" class="tab-button" data-tab="create">Create New Material</button>
            </div>

            <!-- Search Tab Content -->
            <div id="searchContent" class="tab-content">
                <div class="material-search-container">
                    <input type="text" id="materialSearch" placeholder="Search materials...">
                </div>
                <div id="materialsList">
                    {% for material in materials %}
                        {% set material_ids = project.materials|map(attribute='material_id')|list %}
                        {% if material.id not in material_ids %}
                            <div class="material-item" data-name="{{ material.name.lower() }}" data-description="{{ material.description|lower if material.description else '' }}">
                                <div>
                                    <div class="material-item-name">{{ material.name }}</div>
                                    <div class="material-item-description">
                                        {% if material.description %}
                                            {{ material.description }}
                                        {% else %}
                                            No description
                                        {% endif %}
                                    </div>
                                </div>
                                <form action="/project/{{ project.id }}/add_material/{{ material.id }}" method="POST">
                                    <button type="submit">Add</button>
                                </form>
                            </div>
                        {% endif %}
                    {% endfor %}
                    {% if not materials %}
                        <p class="no-materials">No materials available to add.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Create Tab Content -->
            <div id="createContent" class="tab-content">
                <form action="/materials" method="POST">
                    <input type="hidden" name="project_id" value="{{ project.id }}">
                    <div>
                        <label for="material_name">Material Name</label>
                        <input type="text" id="material_name" name="name" required>
                    </div>
                    <div>
                        <label for="material_description">Description</label>
                        <textarea id="material_description" name="description"></textarea>
                    </div>
                    <div>
                        <label for="material_price">Price ($)</label>
                        <input type="number" id="material_price" name="price" step="0.01" min="0">
                    </div>
                    <div>
                        <label for="material_link">Link/URL</label>
                        <input type="url" id="material_link" name="link" placeholder="https://example.com">
                    </div>
                    <div>
                        <label for="material_specification_notes">Specification Notes</label>
                        <textarea id="material_specification_notes" name="specification_notes"></textarea>
                    </div>
                    <div>
                        <label>Tags</label>
                        
                        <div class="tag-creation-container">
                            <div>
                                <label class="tag-creation-label">Create New Tag</label>
                                <input type="text" id="new_tag_name" class="tag-creation-input" placeholder="Tag name (e.g., 'Urgent', 'Electronics')">
                                <div class="tag-creation-grid">
                                    <div class="tag-creation-color-container">
                                        <label class="tag-creation-color-label">Color</label>
                                        <input type="color" id="new_tag_color" class="tag-creation-color" value="#00ff88">
                                    </div>
                                    <div class="tag-creation-button-container">
                                        <button type="button" id="create-tag-btn" class="tag-create-btn">Create Tag</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tags-list" class="tags-list">
                            {% if tags %}
                                {% for tag in tags %}
                                    <label>
                                        <input type="checkbox" name="tags" value="{{ tag.id }}">
                                        <span class="tag-badge" style="background-color: {{ tag.color }};">{{ tag.name }}</span>
                                    </label>
                                {% endfor %}
                            {% else %}
                                <p class="no-tags">No tags available. Create one above!</p>
                            {% endif %}
                        </div>
                        <div id="new-tags-container"></div>
                    </div>
                    
                    <div class="contact-section">
                        <label class="contact-option-label">Associated Contact (Optional)</label>
                        <div>
                            <label class="contact-option-small-label">Choose an option:</label>
                            <select id="contact_option" class="contact-option-select">
                                <option value="none">None</option>
                                <option value="select">Select Existing Contact</option>
                                <option value="create">Create New Contact</option>
                            </select>
                        </div>
                        <div id="select_contact_div">
                            <select id="existing_contact_id" name="contact_id" class="contact-option-select">
                                <option value="">-- Select a contact --</option>
                                {% for contact in contacts %}
                                    <option value="{{ contact.id }}">{{ contact.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div id="create_contact_div">
                            <div>
                                <label class="contact-option-small-label">Name</label>
                                <input type="text" id="new_contact_name" class="contact-input" name="new_contact_name" placeholder="Contact name">
                            </div>
                            <div>
                                <label class="contact-option-small-label">Email</label>
                                <input type="email" id="new_contact_email" class="contact-input" name="new_contact_email" placeholder="Email address">
                            </div>
                            <div>
                                <label class="contact-option-small-label">Phone</label>
                                <input type="tel" id="new_contact_phone" class="contact-input" name="new_contact_phone" placeholder="Phone number">
                            </div>
                            <div>
                                <label class="contact-checkbox-label">
                                    <input type="checkbox" id="new_contact_is_store" name="new_contact_is_store">
                                    This is a store/supplier
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="material-submit-btn">Create & Add to Project</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Material Modal -->
    <div id="editMaterialModal">
        <div>
            <span class="close">&times;</span>
            <h2>Edit Material</h2>

            <form id="editMaterialForm">
                <input type="hidden" id="editMaterialId" name="material_id">
                <div>
                    <label for="edit_material_name">Material Name</label>
                    <input type="text" id="edit_material_name" name="name" required>
                </div>
                <div>
                    <label for="edit_material_description">Description</label>
                    <textarea id="edit_material_description" name="description"></textarea>
                </div>
                <div>
                    <label for="edit_material_price">Price ($)</label>
                    <input type="number" id="edit_material_price" name="price" step="0.01" min="0">
                </div>
                <div>
                    <label for="edit_material_link">Link/URL</label>
                    <input type="url" id="edit_material_link" name="link" placeholder="https://example.com">
                </div>
                <div>
                    <label for="edit_material_specification_notes">Specification Notes</label>
                    <textarea id="edit_material_specification_notes" name="specification_notes"></textarea>
                </div>
                <div>
                    <label>Tags</label>
                    
                    <div class="tag-creation-container">
                        <div>
                            <label class="tag-creation-label">Create New Tag</label>
                            <input type="text" id="edit_new_tag_name" class="tag-creation-input" placeholder="Tag name (e.g., 'Urgent', 'Electronics')">
                            <div class="tag-creation-grid">
                                <div class="tag-creation-color-container">
                                    <label class="tag-creation-color-label">Color</label>
                                    <input type="color" id="edit_new_tag_color" class="tag-creation-color" value="#00ff88">
                                </div>
                                <div class="tag-creation-button-container">
                                    <button type="button" id="edit_create-tag-btn" class="tag-create-btn">Create Tag</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="edit_tags-list" class="tags-list">
                        {% if tags %}
                            {% for tag in tags %}
                                <label>
                                    <input type="checkbox" name="edit_tags" value="{{ tag.id }}">
                                    <span class="tag-badge" style="background-color: {{ tag.color }};">{{ tag.name }}</span>
                                </label>
                            {% endfor %}
                        {% else %}
                            <p class="no-tags">No tags available. Create one above!</p>
                        {% endif %}
                    </div>
                    <div id="edit_new-tags-container"></div>
                </div>
                <div class="material-button-group">
                    <button type="submit">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>